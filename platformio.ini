
[platformio]
default_envs = uno
src_dir     = firmware/src
include_dir = firmware/include
lib_dir     = firmware/lib
test_dir    = firmware/test

; ============================================================================
; Entorno principal: Arduino UNO (ATmega328P)
; ============================================================================
; Hardware:
;   - RS-485: MAX485 en pin D2 (DE/RE)
;   - MPU6050: I2C (A4=SDA, A5=SCL) addr 0x68
;   - HX711: D5 (DOUT), D6 (SCK)
;   - Anemómetro: A0 (analógico 0.4-2.0V → 0-32.4 m/s)
;   - LED status: D13
; Sensores habilitados: MPU6050 + Wind + Load(opcional)
; ============================================================================
[env:uno]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
lib_deps =
  Wire
  paulstoffregen/OneWire @ ^2.3.7
  milesburton/DallasTemperature @ ^3.9.1
  bogde/HX711 @ ^0.7.5
build_flags =
  ; === Serial y pines de hardware ===
  -DSERIAL_RX_BUFFER_SIZE=128
  -DRS485_DERE_PIN=2
  -DSTATUS_LED_PIN=13
  -DMPU6050_I2C_ADDR=0x68
  -DUART_BAUDRATE=115200UL
  
  ; === Identificación del dispositivo ===
  -DUNIT_ID=8
  -DFW_VERSION_GLOBAL=1
  -DFW_VERSION_MINOR=1
  -DFW_VERSION_PATCH=1
  -DHW_VERSION_MAJOR=1
  -DHW_VERSION_MINOR=3
  -DHW_VERSION_PATCH=2
  
  ; === Sensores habilitados ===
  -DSENSORS_MPU_ENABLED=0         ; MPU deshabilitado (solo LoadSensor)
  -DSENSORS_LOAD_ENABLED=1        ; LoadSensor habilitado
  -DSENSORS_USE_MOCK=0
  -DSENSORS_WIND_ENABLED=0        ; Anemómetro deshabilitado
  
  ; === Configuración anemómetro ===
  -DWIND_SPEED_ANALOG_PIN=A0
  -DWIND_VOLT_MIN=0.40
  -DWIND_VOLT_MAX=2.00
  -DWIND_SPEED_MAX=32.40
  -DWIND_ADC_REF_V=5.00
  -DWIND_SAMPLES_AVG=4
  
  ; === Configuración HX711 (sensor de carga) ===
  -DHX711_DOUT_PIN=7
  -DHX711_SCK_PIN=8
  -DHX711_CALIBRATION_FACTOR=251.16
  ; === MODO DEBUG TEMPORAL: para diagnosticar por qué no actualiza registros ===
  ;-DHX711_DEV_MODE=1                   ; Modo debug (con prints para diagnosticar)
  -DHX711_OFFSET=101896L               ; Offset calibrado (capturado en sesión anterior)
  
  -Ifirmware/include

; ============================================================================
; Entorno de test: escaneo I2C
; ============================================================================
[env:test_i2c]
platform = atmelavr
board = uno
framework = arduino
monitor_speed = 115200
lib_deps =
  Wire
build_src_filter = 
  +<../test/test_i2c_scan.cpp>

